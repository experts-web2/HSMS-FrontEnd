
<div class="patient-page">
  <div class="flex justify-between my-3">
    <h1 class="first-title">Health Record</h1>
  </div>
  <div class="grid grid-cols-3 my-2" *ngIf="healthRecord.doctor">
    <div> <span><strong>Dctor Name: </strong>{{healthRecord.doctor?.name}}</span></div>
    <div> <span><strong>Patient Name: </strong>{{healthRecord.patient?.name}}</span></div>
    <div> <span><strong>Visit Date: </strong>{{healthRecord.createdAt | date: "MMM, dd/yyyy"}}</span></div>
  </div>
  <div class="flex flex-col lg:flex-row xl:gap-x-4 gap-y-4 justify-between relative" *ngIf="patient || token">
    <div class="flex user-left-section" [ngClass]="userSideSection ? 'user-side-show':'user-side-hide'">
      <div class="flex flex-col gap-2 section-menu-content">
        <div class="flex active-section bg-white rounded-md px-2 py-2 mb-2 md:mb-0 md:py-4 gap-4 h-fit overflow-scroll w-full">
          <p-button [ngClass]="currentTabId === 'Prescription' ? '':'outline-btn'" (onClick)="scrollToSection('Prescription')">Prescription</p-button>
          <p-button [ngClass]="currentTabId === 'Vitals' ? '':'outline-btn'" (onClick)="scrollToSection('Vitals')">Vitals</p-button>
          <p-button [ngClass]="currentTabId === 'Medication' ? '':'outline-btn'" (onClick)="scrollToSection('Medication')">Medication</p-button>
          <p-button [ngClass]="currentTabId === 'LabOrder' ? '':'outline-btn'" (onClick)="scrollToSection('LabOrder')">Lab Order</p-button>
          <p-button [ngClass]="currentTabId === 'Documents'? '':'outline-btn'" (onClick)="scrollToSection('Documents')">Documents</p-button>
        </div> 
        <div class="bg-white active-section rounded-md flex flex-col gap-2 p-2">
          <h3>History Visits</h3>
          <div class="flex active-section bg-white rounded-md px-2 py-2 mb-2 md:mb-0 md:py-4 gap-4 h-fit overflow-scroll w-full">
            <p-button *ngFor="let hr of patientHistoryHealthRecords"  [ngClass]="healthRecord.id === hr.id ? '':'outline-btn'" (onClick)="getHealthRecordById(hr.id)">{{hr.createdAt | date: 'dd/MM/yyyy'}}</p-button>
          </div>
        </div>
      </div>   
    <i class="fa fa-solid fa-bars text-3xl h-fit pr-1 user-profile-icon cursor-pointer bg-white flex xl:hidden" [ngClass]="userSideSection ? '':'mt-12'" (click)="userSideSection = !userSideSection"></i>
    </div>
    <section class="flex flex-col md:flex-row md:gap-x-4 overflow-scroll">
      <div class="flex-column align-items-center">
        <div class="gap-16 grid h-screen overflow-scroll rounded-3 w-full h-fit bg-white p-3"  #sectionContainer appSectionVisibility (mostVisibleSection)="handleSectionVisibility($event)">
          <section id="Prescription" #Prescription>
            <h2 class="text-2xl">Prescription</h2>
            <app-prescription [healthRecord]="healthRecord" [historyTokenId]="historyTokenId" (emitRequest)="prescription = $event"
                [healthRecordId]="healthRecordId"></app-prescription>
          </section>
          <section id="Vitals" #Vitals>
            <h2 class="text-2xl">Vitals</h2>
            <app-vitals [healthRecord]="healthRecord" [historyTokenId]="historyTokenId" (emitRequest)="vitals = $event"
                [healthRecordId]="healthRecordId"></app-vitals>
          </section>
          <section id="Medication" #Medication>
            <h2 class="text-2xl">Medication</h2>
            <app-medication [healthRecord]="healthRecord" [historyTokenId]="historyTokenId" (emitRequest)="medication = $event"
                [healthRecordId]="healthRecordId"></app-medication>
          </section>
          <section id="LabOrder" #LabOrder>
            <h2 class="text-2xl">Lab Order</h2>
            <app-lab-order [token]="token" (emitRequest)="labOrder = $event" [healthRecord]="healthRecord"
            [healthRecordId]="healthRecordId"></app-lab-order>
          </section>
          <section id="Documents" #Documents>
            <h2 class="text-2xl">Documents</h2>
            <app-files-preview [patientId]="patient.id"></app-files-preview>

          </section>
        </div>
        <div class="flex bg-white p-3 mt-2 rounded-md">
          <div class="m-1">
            <p-button class="" [label]="'Upload a file'" (onClick)="openUploadFileDialog()"
              [icon]="'https://www.primefaces.org/cdn/api/upload.php'"></p-button>
          </div>
          <div class="m-1"> <p-button [label]="'Print Prescription'" (onClick)="openPrescriptionPrintDialogue()"></p-button>
          </div>
        </div>
      </div>
    </section>
    <div class="flex user-profile" [ngClass]="userProfile ? 'user-about-show pl-3 rounded':'user-about-hide'">
    <i class="fa fa-solid fa-bars text-3xl user-profile-icon bg-white rounded h-fit cursor-pointer flex xl:hidden" [ngClass]="userProfile ? '-mr-8':''" (click)="userProfile = !userProfile"></i>
      <div class="grid grid-cols-1 gap-y-3 justify-between profile-wrapper" [ngClass]="userProfile ? '':''">
        <div class="d-flex flex-column bg-white align-items-center p-3 rounded-3">
          <img
            src="https://static.vecteezy.com/system/resources/previews/005/544/718/original/profile-icon-design-free-vector.jpg"
            alt="Profile Picture" class="profile-picture rounded-5 bg-dark">
          <div class="profile-details">
            <h1 class="profile-name my-2">{{patient.name}}</h1>
            <p class="profile-info"><b>{{getGender(patient.gender)}}:</b> {{patient.age.split('-').at(0)}}</p>
            <p class="profile-location my-2">{{''}}</p>
          </div>
          <p-button>Update</p-button>
        </div>
        <div class="col-span-2">
          <p-panel header="Summary" [toggleable]="true" aria-expanded="false">
            <div class="medical-info d-flex flex-column bg-white align-items-center">
              <h2 class="section-title">Vitals</h2>
              <div class="history-item-div"><span class="patient-info-labels"><i
                    class="fa-solid w-5 fa-heart-pulse mr-3"></i>Pulse Heart
                  Rate:</span><span>{{healthRecord.vital?.pulseHeartRate ?? 'N/A'}}</span></div>
              <div class="history-item-div"><span class="patient-info-labels"><i
                    class="fa fas w-5 fa-regular fa-temperature-high mr-3"></i>Temprature:</span><span>{{healthRecord.vital?.temperature
                  ?? 'N/A'}}</span></div>
              <div class="history-item-div"><span class="patient-info-labels"><i
                    class="fa-solid w-5 fa-light fa-ruler-vertical mr-3"></i>height:</span><span>{{healthRecord.vital?.height
                  ?? 'N/A'}}</span></div>
              <div class="history-item-div"><span class="patient-info-labels"><i
                    class="fa-solid w-5 fa-weight-scale mr-3"></i>Weight (kg):</span><span>{{healthRecord.vital?.weight ?? 'N/A'}}</span></div>
              <div class="history-item-div"><span class="patient-info-labels"><i
                    class="fa-solid w-5 fa-child mr-3"></i>BMI:</span><span>{{healthRecord.vital?.bodyMassIndex ?? 'N/A'}}</span></div>
              <div class="history-item-div"><span class="patient-info-labels"><i
                    class="fa-solid w-5 fa-heart mr-3"></i>Blood Pressure:</span><span>{{healthRecord.vital?.bloodPressure
                  ?? 'N/A'}}</span></div>
              <div class="history-item-div"><span class="patient-info-labels"><i
                    class="fa-solid w-5 fa-lungs mr-3"></i>Oxygen
                  Saturation:</span><span>{{healthRecord.vital?.oxygenSaturation ?? 'N/A'}}</span></div>
              <div class="history-item-div"><span class="patient-info-labels"><i
                    class="fa-solid w-5 fa-lungs mr-3"></i>Respiratory
                  Rate:</span><span>{{healthRecord.vital?.respiratoryRate ?? 'N/A'}}</span></div>
              <div class="history-item-div"><span class="patient-info-labels"><i
                    class="fa-solid w-5 fa-lungs mr-3"></i>Blood Sugar:</span><span>{{healthRecord.vital?.bloodSugar ??
                  'N/A'}}</span></div>
            </div>
          </p-panel>
        </div>
      </div>
    </div>

  </div>
</div>
